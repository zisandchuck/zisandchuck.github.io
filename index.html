<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Roblox工具卡密领取</title>
    <script src="https://cdn.linkvertise.com/cdn/anti-bypassing/script.js"></script>
    <style>
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: 50px auto;
  padding: 20px;
  text-align: center;
  background-color: #1a1a1a;
  color: #ffffff;
}
.container {
  background-color: #2d2d2d;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}
button {
  padding: 12px 30px;
  margin-top: 20px;
  background-color: #7289da;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}
button:hover {
  background-color: #677bc4;
}
#codeDisplay {
  margin-top: 20px;
  padding: 15px;
  background-color: #3d3d3d;
  border-radius: 5px;
  font-size: 18px;
  letter-spacing: 2px;
  display: none;
}
.countdown {
  margin-top: 10px;
  font-size: 14px;
  color: #7289da;
}
.validity {
  margin-top: 5px;
  font-size: 14px;
  color: #999;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Roblox工具卡密领取</h1>
        <p>你已完成广告验证，点击下方按钮生成卡密（10分钟内仅可生成1次）</p>
        <button onclick="generateCode()">点击生成卡密</button>
        <div id="codeDisplay"></div>
        <div class="countdown" id="countdown"></div>
        <div class="validity">卡密使用：打开Roblox工具后输入验证 | 页面10分钟后失效</div>
    </div>

    <script>
const LV_ANTI_BYPASS_TOKEN = "049c0533108ac041663bb4c5c0e2c0c625cb94b685ef248f62074104e4a5770e";
const LV_SESSION_PARAM = "lv_session";
const LV_NEW_SHORT_LINK = "https://link-center.net/2615052/eOL0TcOnzjnQ";
const VALID_DURATION = 600000;
let sessionExpireTimer = null;

window.onload = function() {
  // 反绕过验证+延迟500ms，解决秒跳
  if (typeof linkvertiseAntiBypassing !== 'undefined') {
    linkvertiseAntiBypassing.init({token: LV_ANTI_BYPASS_TOKEN,redirect: LV_NEW_SHORT_LINK});
    setTimeout(() => {
      if (!linkvertiseAntiBypassing.isValid()) {
        alert("请通过正规广告渠道访问！");
        window.location.href = LV_NEW_SHORT_LINK;
        return;
      }
    }, 500);
  }

  // 验证会话参数
  const urlParams = new URLSearchParams(window.location.search);
  const lvSession = urlParams.get(LV_SESSION_PARAM);
  if (!lvSession) {window.location.href = LV_NEW_SHORT_LINK;return;}

  // 初始化10分钟有效期+倒计时
  const expireTime = Date.now() + VALID_DURATION;
  localStorage.setItem(`lv_session_expire_${lvSession}`, expireTime);
  startExpireCountdown(expireTime);

  // 10分钟后自动跳转+清除记录
  sessionExpireTimer = setTimeout(() => {
    localStorage.removeItem(`lv_session_expire_${lvSession}`);
    localStorage.removeItem("last_generate_time");
    if (typeof linkvertiseAntiBypassing !== 'undefined') linkvertiseAntiBypassing.invalidate();
    window.location.href = LV_NEW_SHORT_LINK;
  }, VALID_DURATION);
};

function startExpireCountdown(expireTime) {
  const countdownEl = document.getElementById("countdown");
  const update = () => {
    const remain = Math.ceil((expireTime - Date.now())/1000);
    countdownEl.innerText = remain<=0?"页面即将失效！":`剩余有效时间：${Math.floor(remain/60)}分${(remain%60).toString().padStart(2,'0')}秒`;
  };
  update();setInterval(update,1000);
}

function generateRandomCode() {
  let code="";const CHAR_SET="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  do{code="";for(let i=0;i<8;i++)code+=CHAR_SET[Math.floor(Math.random()*CHAR_SET.length)];}while(localStorage.getItem(`code_${code}`));
  return code;
}

function generateCode() {
  const now=Date.now(),el=document.getElementById("codeDisplay"),last=Number(localStorage.getItem("last_generate_time"))||0;
  if(now-last<VALID_DURATION){el.style.display="block";el.innerText=`请等${Math.ceil((VALID_DURATION-(now-last))/60000)}分钟`;return;}
  const code=generateRandomCode();
  localStorage.setItem(`code_${code}`,now);localStorage.setItem("last_generate_time",now);
  el.style.display="block";el.innerText="你的卡密："+code;
}

window.onunload=()=>{if(sessionExpireTimer)clearTimeout(sessionExpireTimer);};
    </script>
</body>
</html>

