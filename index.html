<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Roblox å¡å¯†è·å–</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: #0f172a; color: #f8fafc; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .header { text-align: center; color: #818cf8; margin-bottom: 2rem; font-size: 2rem; }
        .countdown-card { background: #1e293b; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; text-align: center; border-left: 4px solid #f87171; }
        .countdown-text { font-size: 1.2rem; color: #f87171; font-weight: bold; }
        .key-card { background: #1e293b; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; text-align: center; min-height: 120px; display: flex; align-items: center; justify-content: center; }
        .key-display { font-size: 1.5rem; font-weight: bold; color: #818cf8; letter-spacing: 2px; cursor: pointer; transition: all 0.3s; }
        .key-display:hover { color: #a5b4fc; }
        .btn { width: 100%; padding: 1.2rem; background: #818cf8; color: white; border: none; border-radius: 12px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem; }
        .btn:disabled { background: #64748b; cursor: not-allowed; opacity: 0.7; }
        .tip-text { color: #94a3b8; font-size: 0.9rem; text-align: center; margin-bottom: 0.5rem; }
        .message { text-align: center; font-weight: bold; margin-top: 1rem; min-height: 20px; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
    </style>
</head>
<body>
    <h1 class="header">ğŸ‰ Free Roblox å¡å¯†è·å–</h1>

    <!-- ç½‘é¡µæœ‰æ•ˆæœŸå€’è®¡æ—¶ -->
    <div class="countdown-card">
        <p class="countdown-text">ç½‘é¡µå°†åœ¨ <span id="expire-time">300</span> ç§’åå¤±æ•ˆï¼Œè¯·å°½å¿«è·å–å¡å¯†ï¼</p>
    </div>

    <!-- å¡å¯†æ˜¾ç¤ºå®¹å™¨ -->
    <div class="key-card" id="key-container">
        <span class="tip-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–å¡å¯†</span>
    </div>

    <!-- è·å–å¡å¯†æŒ‰é’® -->
    <button class="btn" id="get-key-btn">ç‚¹å‡»è·å–å…è´¹å¡å¯†</button>

    <!-- æç¤ºä¿¡æ¯ -->
    <p class="tip-text">å¡å¯†æ ¼å¼ï¼šFree-XXXXXXXXXXXXXXXXï¼ˆæ¿€æ´»å16å°æ—¶å†…æœ‰æ•ˆï¼‰</p>
    <p class="tip-text">æ¯ä¸ªé¡µé¢ä»…å¯è·å–1æ¬¡å¡å¯†ï¼Œé‡æ–°è·å–éœ€å®ŒæˆLootLabså¹¿å‘Š</p>
    <div class="message" id="message-box"></div>

    <script>
        // å·²å¡«å…¥ä½ çš„WorkeråŸŸåï¼Œæ— éœ€ä¿®æ”¹ï¼
        const WORKER_API_URL = "https://roblox-auth.check868.workers.dev";
        // æ›¿æ¢ä¸ºä½ çš„LootLabsçŸ­é“¾ï¼ˆå¿…å¡«ï¼Œå¦åˆ™5åˆ†é’Ÿåè·³è½¬å¤±æ•ˆï¼‰
        const LOOTLABS_LINK = "https://lootlabs.com/link/ä½ çš„çŸ­é“¾"; 
        const PAGE_EXPIRE_SEC = 5 * 60; // 5åˆ†é’Ÿç½‘é¡µæœ‰æ•ˆæœŸ

        // æ ¸å¿ƒçŠ¶æ€å˜é‡
        let isBtnClicked = false;
        let pageId = generatePageId();
        let expireTimer = null;

        // ç”Ÿæˆä¼šè¯å”¯ä¸€PageId
        function generatePageId() {
            return Math.random().toString(36).slice(2, 18) + Math.random().toString(36).slice(2, 18);
        }

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = async () => {
            const getKeyBtn = document.getElementById("get-key-btn");
            const keyContainer = document.getElementById("key-container");
            const messageBox = document.getElementById("message-box");
            const expireTimeEl = document.getElementById("expire-time");

            // éªŒè¯é¡µé¢æœ‰æ•ˆæ€§
            try {
                const res = await fetch(`${WORKER_API_URL}/check-page-valid?pageId=${pageId}`);
                // æ ¡éªŒå“åº”æ˜¯å¦æ­£å¸¸
                if (!res.ok) throw new Error(`æ¥å£è¿”å›é”™è¯¯ï¼š${res.status}`);
                
                const data = await res.json();
                if (!data.valid) {
                    keyContainer.innerHTML = '<span class="error">ç½‘é¡µé“¾æ¥å·²å¤±æ•ˆï¼</span>';
                    getKeyBtn.disabled = true;
                    setTimeout(() => window.location.href = LOOTLABS_LINK, 3000);
                    return;
                }

                // åˆå§‹åŒ–å€’è®¡æ—¶
                let remainSec = data.expireIn || PAGE_EXPIRE_SEC;
                expireTimeEl.textContent = remainSec;
                expireTimer = setInterval(() => {
                    remainSec--;
                    expireTimeEl.textContent = remainSec;
                    if (remainSec <= 0) {
                        clearInterval(expireTimer);
                        window.location.href = LOOTLABS_LINK;
                    }
                }, 1000);

                // ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
                getKeyBtn.addEventListener("click", async () => {
                    if (isBtnClicked) {
                        showMessage("å½“å‰é¡µé¢å·²è·å–è¿‡å¡å¯†ï¼", "error");
                        return;
                    }

                    isBtnClicked = true;
                    getKeyBtn.disabled = true;
                    keyContainer.innerHTML = '<span class="tip-text">æ­£åœ¨ç”Ÿæˆå¡å¯†...</span>';

                    // è°ƒç”¨ç”Ÿæˆå¡å¯†æ¥å£
                    try {
                        const keyRes = await fetch(`${WORKER_API_URL}/generate-key?pageId=${pageId}`);
                        if (!keyRes.ok) throw new Error(`å¡å¯†æ¥å£é”™è¯¯ï¼š${keyRes.status}`);
                        
                        const keyData = await keyRes.json();
                        if (keyData.success) {
                            keyContainer.innerHTML = `<span class="key-display" onclick="copyKey('${keyData.key}')">${keyData.key}</span>`;
                            showMessage(keyData.message, "success");
                        } else {
                            keyContainer.innerHTML = '<span class="tip-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–å¡å¯†</span>';
                            showMessage(keyData.message, "error");
                        }
                    } catch (err) {
                        keyContainer.innerHTML = '<span class="tip-text">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–å¡å¯†</span>';
                        showMessage(`å¡å¯†ç”Ÿæˆå¤±è´¥ï¼š${err.message}`, "error");
                    }
                });
            } catch (err) {
                // æ‰“å°é”™è¯¯è¯¦æƒ…åˆ°æ§åˆ¶å°ï¼Œæ–¹ä¾¿æ’æŸ¥
                console.error("é¡µé¢åˆå§‹åŒ–å¤±è´¥è¯¦æƒ…ï¼š", err);
                showMessage(`é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼š${err.message}`, "error");
                getKeyBtn.disabled = true;
            }
        };

        // å¤åˆ¶å¡å¯†åˆ°å‰ªè´´æ¿
        function copyKey(key) {
            navigator.clipboard.writeText(key)
                .then(() => showMessage(`å¡å¯†å·²å¤åˆ¶ï¼š${key}`, "success"))
                .catch(() => showMessage("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶", "error"));
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showMessage(text, type) {
            const messageBox = document.getElementById("message-box");
            messageBox.textContent = text;
            messageBox.className = `message ${type}`;
            setTimeout(() => messageBox.className = "message", 5000);
        }

        // é¡µé¢å…³é—­æ¸…ç†å®šæ—¶å™¨
        window.onbeforeunload = () => {
            if (expireTimer) clearInterval(expireTimer);
        };
    </script>
</body>
</html>
