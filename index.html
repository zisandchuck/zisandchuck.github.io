<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Roblox工具卡密领取</title>
    <!-- Linkvertise反绕过脚本（direct-link基于Linkvertise，脚本通用） -->
    <script src="https://cdn.linkvertise.com/cdn/anti-bypassing/script.js"></script>
    <style>
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: 50px auto;
  padding: 20px;
  text-align: center;
  background-color: #1a1a1a;
  color: #ffffff;
}
.container {
  background-color: #2d2d2d;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,0.5);
}
button {
  padding: 12px 30px;
  margin-top: 20px;
  background-color: #7289da;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}
button:disabled {
  background-color: #555555;
  cursor: not-allowed;
}
button:hover:not(:disabled) {
  background-color: #677bc4;
}
#codeDisplay {
  margin-top: 20px;
  padding: 15px;
  background-color: #3d3d3d;
  border-radius: 5px;
  font-size: 18px;
  letter-spacing: 2px;
  display: none;
}
.countdown {
  margin-top: 10px;
  font-size: 14px;
  color: #7289da;
}
.button-cooldown {
  margin-top: 5px;
  font-size: 14px;
  color: #ff6b6b;
}
.validity {
  margin-top: 5px;
  font-size: 14px;
  color: #999;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Roblox工具卡密领取</h1>
        <p>你已完成广告验证，点击下方按钮生成卡密（10分钟内仅可生成1次）</p>
        <button id="generateBtn" onclick="triggerCodeGeneration()">点击生成卡密</button>
        <div class="button-cooldown" id="buttonCooldown" style="display: none;"></div>
        <div id="codeDisplay"></div>
        <div class="countdown" id="countdown"></div>
        <div class="validity">卡密使用：打开Roblox工具后输入验证 | 页面10分钟后失效</div>
    </div>

    <script>
// 核心配置（已替换为新短链，保留反绕过令牌）
const LV_ANTI_BYPASS_TOKEN = "049c0533108ac041663bb4c5c0e2c0c625cb94b685ef248f62074104e4a5770e";
const NEW_DIRECT_LINK = "https://direct-link.net/2615052/Pfqr63wwDqQQ"; // 新短链
const VALID_DURATION = 600000; // 10分钟全局冷却/页面失效
const BUTTON_COOLDOWN = 5000; // 点击后5秒生成冷却
const SESSION_ID_KEY = "lv_local_session_id"; // 本地会话ID（防直接访问）
let sessionExpireTimer = null;

// 生成本地随机会话ID（防缓存复用）
function generateLocalSessionId() {
  const chars = "0123456789abcdef";
  let id = "";
  for (let i = 0; i < 32; i++) {
    id += chars[Math.floor(Math.random() * chars.length)];
  }
  return id;
}

// 页面加载验证（反绕过+本地会话，无URL参数）
window.onload = function() {
  // 1. 反绕过验证（direct-link基于Linkvertise，脚本直接生效）
  if (typeof linkvertiseAntiBypassing !== 'undefined') {
    linkvertiseAntiBypassing.init({
      token: LV_ANTI_BYPASS_TOKEN,
      redirect: NEW_DIRECT_LINK
    });

    // 绕开广告直接访问 → 强制跳转新短链
    if (!linkvertiseAntiBypassing.isValid()) {
      alert("请通过正规广告渠道访问！");
      window.location.href = NEW_DIRECT_LINK;
      return;
    }
  } else {
    // 脚本加载失败也跳转
    window.location.href = NEW_DIRECT_LINK;
    return;
  }

  // 2. 本地会话验证（防缓存页面复用）
  let sessionId = localStorage.getItem(SESSION_ID_KEY);
  let sessionExpireTime = localStorage.getItem(`session_expire_${sessionId}`);
  
  if (!sessionId || !sessionExpireTime || Date.now() > Number(sessionExpireTime)) {
    sessionId = generateLocalSessionId();
    sessionExpireTime = Date.now() + VALID_DURATION;
    localStorage.setItem(SESSION_ID_KEY, sessionId);
    localStorage.setItem(`session_expire_${sessionId}`, sessionExpireTime);
  }

  // 3. 启动10分钟页面倒计时
  startExpireCountdown(Number(sessionExpireTime));

  // 4. 10分钟后自动跳转+清除记录
  sessionExpireTimer = setTimeout(() => {
    localStorage.removeItem(SESSION_ID_KEY);
    localStorage.removeItem(`session_expire_${sessionId}`);
    localStorage.removeItem("last_generate_time");
    if (typeof linkvertiseAntiBypassing !== 'undefined') {
      linkvertiseAntiBypassing.invalidate();
    }
    window.location.href = NEW_DIRECT_LINK;
  }, VALID_DURATION);
};

// 点击按钮：5秒冷却后生成卡密
function triggerCodeGeneration() {
  const generateBtn = document.getElementById("generateBtn");
  const buttonCooldownEl = document.getElementById("buttonCooldown");
  const now = Date.now();
  const lastGenTime = Number(localStorage.getItem("last_generate_time")) || 0;

  // 先校验10分钟全局冷却
  if (now - lastGenTime < VALID_DURATION) {
    const remain = Math.ceil((VALID_DURATION - (now - lastGenTime)) / 60000);
    const displayEl = document.getElementById("codeDisplay");
    displayEl.style.display = "block";
    displayEl.innerText = `请等待${remain}分钟后再生成！`;
    return;
  }

  // 5秒冷却逻辑
  generateBtn.disabled = true;
  buttonCooldownEl.style.display = "block";
  let remainingSeconds = BUTTON_COOLDOWN / 1000;
  buttonCooldownEl.innerText = `卡密生成中... 剩余${remainingSeconds}秒`;

  const cooldownInterval = setInterval(() => {
    remainingSeconds--;
    buttonCooldownEl.innerText = `卡密生成中... 剩余${remainingSeconds}秒`;
    if (remainingSeconds <= 0) {
      clearInterval(cooldownInterval);
      generateCode(); // 冷却结束生成卡密
      generateBtn.disabled = false;
      buttonCooldownEl.style.display = "none";
    }
  }, 1000);
}

// 生成8位唯一卡密
function generateCode() {
  const newCode = generateRandomCode();
  const now = Date.now();
  const displayEl = document.getElementById("codeDisplay");

  localStorage.setItem(`code_${newCode}`, now);
  localStorage.setItem("last_generate_time", now);

  displayEl.style.display = "block";
  displayEl.innerText = "你的卡密：" + newCode;
}

// 生成随机卡密（避免重复）
function generateRandomCode() {
  let code = "";
  const CHAR_SET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  do {
    code = "";
    for (let i = 0; i < 8; i++) {
      code += CHAR_SET[Math.floor(Math.random() * CHAR_SET.length)];
    }
  } while (localStorage.getItem(`code_${code}`));
  return code;
}

// 页面10分钟有效期倒计时
function startExpireCountdown(expireTime) {
  const countdownEl = document.getElementById("countdown");
  const update = () => {
    const remain = Math.ceil((expireTime - Date.now()) / 1000);
    countdownEl.innerText = remain <= 0
      ? "页面即将失效！"
      : `页面剩余有效时间：${Math.floor(remain / 60)}分${(remain % 60).toString().padStart(2, '0')}秒`;
  };
  update();
  setInterval(update, 1000);
}

// 页面关闭清除定时器
window.onunload = () => {
  if (sessionExpireTimer) clearTimeout(sessionExpireTimer);
};
    </script>
</body>
</html>

